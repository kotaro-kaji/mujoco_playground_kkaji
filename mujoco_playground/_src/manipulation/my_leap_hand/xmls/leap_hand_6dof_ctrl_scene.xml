<mujoco model="leap_hand_6dof_ctrl">
  <compiler meshdir=""/>

  <!-- Include LEAP Hand (provides finger actuators) -->
  <include file="leap_rh_mjx.xml"/>
  <!-- Include shared reorientation cube (visual + physical) -->
  <include file="reorientation_cube.xml"/>

  <option timestep="0.004" integrator="implicitfast" iterations="10" ls_iterations="20"/>

  <asset>
    <!-- Checker grid for ground -->
    <texture name="grid_tex" type="2d" builtin="checker" width="512" height="512"
             rgb1="0.22 0.22 0.22" rgb2="0.28 0.28 0.28"/>
    <material name="grid_mat" texture="grid_tex" texrepeat="40 40" texuniform="true"/>
  </asset>

  <default>
    <default class="base6dof">
      <joint damping="1e-3" armature="0.0" limited="true"/>
      <position kp="120"/>
    </default>
  </default>

  <worldbody>
    <!-- 6-DoF controllable base -->
    <body name="hand_base" pos="0 0 0.8">
      <!-- Provide mass and rotational inertia so this moving base is physically valid -->
      <inertial mass="1.0" diaginertia="0.01 0.01 0.01" pos="0 0 0"/>
      <!-- Translate -->
      <joint name="base_x" type="slide" axis="1 0 0" range="-1.0 1.0" damping="50.0" armature="0.01" class="base6dof"/>
      <joint name="base_y" type="slide" axis="0 1 0" range="-1.0 1.0" damping="50.0" armature="0.01" class="base6dof"/>
      <joint name="base_z" type="slide" axis="0 0 1" range="0.0 1.5" damping="50.5" armature="0.015" class="base6dof"/>
      <!-- Rotate (ZYX order: yaw, pitch, roll) -->
      <joint name="base_yaw"   type="hinge" axis="0 0 1" range="-3.1416 3.1416" damping="2.0" armature="0.005" class="base6dof"/>
      <joint name="base_pitch" type="hinge" axis="0 1 0" range="-1.57 1.57" damping="2.0" armature="0.005" class="base6dof"/>
      <joint name="base_roll"  type="hinge" axis="1 0 0" range="-1.57 1.57" damping="2.0" armature="0.005" class="base6dof"/>
      <site name="base_mount_site" size="0.01" rgba="0 0 1 0.6"/>
    </body>

    <geom type="plane" name="floor" pos="0 0 -0.5" size="0 0 0.01" contype="0" conaffinity="0"
          material="grid_mat" rgba="1 1 1 1"/>
    <!-- Invisible physical ground for contact tests (keeps grid visual clean) -->
    <geom type="plane" name="ground_physical" pos="0 0 -0.5" size="0 0 0.01" contype="1" conaffinity="1"
          friction="0.8 0.01 0.0001" rgba="1 1 1 0"/>
    <camera name="cam" pos="1.2 0.0 0.9" xyaxes="0.0 -1.0 0.0 0.4 0.0 0.9"/>
  </worldbody>

  <!-- Weld LEAP to the controllable base. Adjust relpose if needed to match the intended mounting -->
  <equality>
    <!-- Overdamped weld to reduce oscillations -->
    <weld body1="hand_base" body2="leap_mount" solref="0.01 2" solimp="0.98 0.995 0.001" relpose="0 0 0 1 0 0 0"/>
  </equality>

  <actuator>
    <!-- Position controllers for 6-DoF base (RL action can write to these) -->
    <position name="act_base_x"     joint="base_x"     kp="200" forcerange="-600 600"/>
    <position name="act_base_y"     joint="base_y"     kp="200" forcerange="-600 600"/>
    <position name="act_base_z"     joint="base_z"     kp="200" forcerange="-600 600"/>
    <position name="act_base_yaw"   joint="base_yaw"   kp="80"  forcerange="-250 250"/>
    <position name="act_base_pitch" joint="base_pitch" kp="80"  forcerange="-250 250"/>
    <position name="act_base_roll"  joint="base_roll"  kp="80"  forcerange="-250 250"/>
  </actuator>
</mujoco>


